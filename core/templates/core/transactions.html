{% extends 'core/base.html' %}

{% block title %} Transactions | {{ block.super }}{% endblock title %}

{% block content %}
{% include "core/messages.html" %}
<!-- closing style for boxes -->

<!-- Quick Overview --><br><br><br>
                <div class="nk-content nk-content-fluid">
                    <div class="container-xl wide-lg">
                        <div class="nk-content-body">
                            <div class="nk-block-head">
                                <div class="nk-block-head-sub">
                                </div>
                                <div class="nk-block-between-md g-4 card-bordered">
                                    <div class="nk-block-head-content">
                                       <h4 class="nk-block-title fw-normal" id="greeting"></h4>

                                <script>
                                  // Get the current hour
                                  var currentHour = new Date().getHours();
                                  var greeting = "";

                                  // Determine the appropriate greeting based on the current hour
                                  if (currentHour >= 5 && currentHour < 12) {
                                    greeting = "Good morning";
                                  } else if (currentHour >= 12 && currentHour < 18) {
                                    greeting = "Good afternoon";
                                  } else {
                                    greeting = "Good evening";
                                  }

                                  // Update the greeting element with the dynamic greeting
                                  document.getElementById("greeting").innerText = greeting + " {{ user.full_name }}";
                                </script>

                                        <div class="nk-block-des">
                                            <p>At a glance summary of your account!</p>
                                        </div>
                                    </div><!-- .nk-block-head-content -->
                                    <div class="nk-block-head-content">
                                        <ul class="nk-block-tools gx-3">
                                           <!-- . <li><a href="{% url 'transactions:payment_create' %}" class="btn btn-primary"><span>Deposit</span> <em class="icon ni ni-arrow-long-right"></em></a></li>  -->
                                            <li><a href="{% url 'transactions:withdrawal' %}" class="btn btn-secondary btn-light text-light"><span>Transfer Fund</span> <em class="icon ni ni-arrow-long-right d-none d-sm-inline-block"></em></a></li>
                                        </ul>
                                    </div><!-- .nk-block-head-content -->
                                </div><!-- .nk-block-between -->
                            </div><!-- .nk-block-head -->
                            <iframe             src="//www.exchangerates.org.uk/widget/ER-LRTICKER.php?w=1400&amp;s=1&amp;mc=GBP&amp;mbg=F0F0F0&amp;bs=yes&amp;bc=000044&amp;f=verdana&amp;fs=10px&amp;fc=000044&amp;lc=000044&amp;lhc=FE9A00&amp;vc=FE9A00&amp;vcu=008000&amp;vcd=FF0000&amp;"             height="30" width="100%" frameborder="0" scrolling="no" marginwidth="0" marginheight="0"></iframe> <br>
{% load humanize %}

<div class="nk-block">
    <div class="row gy-gs">
        <!-- Left Column -->
        <div class="col-lg-6 col-xl-6">
            <div class="nk-block">
                <div class="nk-block-head-xs">
                    <div class="nk-block-head-content">
                        <h5 class="nk-block-title title">Overview</h5>
                    </div>
                </div>
                <div class="nk-block">
                    <div class="card card-bordered text-light is-dark h-100">
                        <div class="card-inner">
                            <div class="nk-wg7">
                                <div class="nk-wg7-stats-group">
                                    <div class="nk-wg7-stats w-50" 
                                         style="background-image: url(../auth/passport/); border-color: white; border-width: 5px; border-radius: 50%;">
                                        <img class="img img-rounded" src="{{ user.account.picture.url }}" width="85" 
                                             height="85" style="border-color: white; border-width: 5px; border-radius:50px;">
                                    </div>
                                    <div class="nk-wg7-stats w-50">
                                        <div class="nk-wg7-title">Available Balance</div>
                                        <div class="amount text-success responsive-balance">
                                            <span style="color:white;" class="currency-symbol">
                                                {% if user.account.account_currency == 'USD' %}$ 
                                                {% elif user.account.account_currency == 'EUR' %}€ 
                                                {% elif user.account.account_currency == 'GBP' %}£ 
                                                {% elif user.account.account_currency == 'JPY' %}¥ 
                                                {% elif user.account.account_currency == 'NGN' %}₦ 
                                                {% else %}{{ user.account.account_currency }} 
                                                {% endif %}
                                            </span>
                                            <span style="color:white;" class="balance-amount" data-balance="{{ user.balance }}">
                                                {{ user.balance }}
                                            </span>
                                            <span class="currency currency-nio">{{ user.account.account_currency }}</span>
                                        </div>
                                        <div class="user-name">{{ user.full_name }}</div>
                                        <div class="account-status">
                                            <span class="badge badge-success">Active Account</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="nk-wg7-stats-group">
                                    <div class="nk-wg7-stats w-50">
                                        <div class="nk-wg7-title">Linked Cards</div>
                                        <div class="number-lg">{{ card_details_counta }}</div>
                                        <div><small>Available Cards</small></div>
                                        <div class="card-info">
                                            <span class="badge badge-outline-light">{{ card_details_count }} Active</span>
                                        </div>
                                    </div>
                                    <div class="nk-wg7-stats w-50">
                                        <div class="nk-wg7-title">Your IP Address</div>
                                        <div class="number ip-info">
                                            <img style="max-width:50px; border-radius: 4px;" id="flag" src="" alt="Country Flag">
                                            <div class="ip-details">
                                                <span id="ip" class="ip-address"></span>
                                                <small id="location" class="text-soft"></small>
                                                <small id="isp" class="text-soft"></small>
                                            </div>
                                        </div>
                                        <div class="security-status">
                                            <span class="badge badge-success">Secure Connection</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- .card-inner -->
                    </div><!-- .card -->
                </div><!-- .nk-block -->
            </div><!-- .nk-block -->
        </div><!-- .col -->

        <!-- Right Column -->
        <div class="col-lg-6 col-xl-6">
            <div class="nk-block">
                <div class="nk-block-head-xs">
                    <div class="nk-block-between-md g-2">
                        <div class="nk-block-head-content">
                            <h5 class="nk-block-title title">Current Account</h5>
                        </div>
                        <div class="nk-block-head-content">
                            <a href="javascript:void(0)" class="btn btn-primary btn-sm">
                                <em class="icon ni ni-tranx"></em>
                                <span>Transfer Fund</span>
                            </a>
                        </div>
                    </div>
                </div><!-- .nk-block-head -->
                <div class="row g-2">
                    <div class="col-sm-12">
                        <div class="card bg-light border-primary">
                            <div class="nk-wgw sm">
                                <a class="nk-wgw-inner" href="#">
                                    <div class="nk-wgw-name">
                                        <div class="nk-wgw-icon bg-primary-dim">
                                            <em class="icon ni ni-sign-cc-alt text-primary"></em>
                                        </div>
                                        <div class="account-details">
                                            <h5 class="nk-wgw-title title">***9482{{ user.account_no }}0</h5>
                                            <span class="account-type">Checking Account</span>
                                        </div>
                                    </div>
                                    <div class="nk-wgw-balance">
                                        <div class="amount text-primary banking-balance">
                                            <span class="currency-symbol">
                                                {% if user.account.account_currency == 'USD' %}$ 
                                                {% elif user.account.account_currency == 'EUR' %}€ 
                                                {% elif user.account.account_currency == 'GBP' %}£ 
                                                {% elif user.account.account_currency == 'JPY' %}¥ 
                                                {% elif user.account.account_currency == 'NGN' %}₦ 
                                                {% else %}{{ user.account.account_currency }} 
                                                {% endif %}
                                            </span>
                                            <span class="balance-amount" data-balance="{{ user.balance }}">{{ user.balance }}</span>
                                            <span class="currency currency-nio">{{ user.account.account_currency }}</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div><!-- .col -->
                </div><!-- .row -->
            </div><!-- .nk-block -->

            <div class="nk-block nk-block-md">
                <div class="nk-block-head-xs">
                    <div class="nk-block-between-md g-2">
                        <div class="nk-block-head-content">
                            <h6 class="nk-block-title title">Loans and Lines of Credit</h6>
                        </div>
                        <div class="nk-block-head-content">
                            <a href="{% url 'transactions:pay_bills' %}" class="btn btn-outline-primary btn-sm">
                                <em class="icon ni ni-bill"></em>
                                <span>Pay Bills</span>
                            </a>
                        </div>
                    </div>
                </div><!-- .nk-block-head -->
                <div class="row g-2">
                    <!-- Business Loan -->
                    <div class="col-sm-6">
                        <div class="card bg-light border-success">
                            <div class="nk-wgw sm">
                                <a class="nk-wgw-inner" href="#">
                                    <div class="nk-wgw-name">
                                        <div class="nk-wgw-icon bg-success-dim">
                                            <em class="icon ni ni-check-circle text-success"></em>
                                        </div>
                                        <div class="loan-details">
                                            <h5 class="nk-wgw-title title">Business Support Loan</h5>
                                            <span class="loan-status text-success">Approved</span>
                                        </div>
                                    </div>
                                    <div class="nk-wgw-balance">
                                        <div class="amount text-success banking-balance">
                                            <span class="currency-symbol">
                                                {% if user.account.account_currency == 'USD' %}$ 
                                                {% elif user.account.account_currency == 'EUR' %}€ 
                                                {% elif user.account.account_currency == 'GBP' %}£ 
                                                {% elif user.account.account_currency == 'JPY' %}¥ 
                                                {% elif user.account.account_currency == 'NGN' %}₦ 
                                                {% else %}{{ user.account.account_currency }} 
                                                {% endif %}
                                            </span>
                                            <span class="balance-amount" data-balance="{{ user.account.support_loan }}">
                                                {{ user.account.support_loan }}
                                            </span>
                                            <span class="currency currency-nio">{{ user.account.account_currency }}</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div><!-- .col -->

                    <!-- Credit Score -->
                    <div class="col-sm-6">
                        <div class="card bg-light border-info">
                            <div class="nk-wgw sm">
                                <a class="nk-wgw-inner" href="#">
                                    <div class="nk-wgw-name">
                                        <div class="nk-wgw-icon bg-info-dim">
                                            <em class="icon ni ni-sign-cc-alt2 text-info"></em>
                                        </div>
                                        <div class="credit-details">
                                            <h5 class="nk-wgw-title title">FICO Credit Score</h5>
                                            <span class="credit-rating">
                                                {% if user.account.credit_score >= 800 %}Excellent
                                                {% elif user.account.credit_score >= 740 %}Very Good
                                                {% elif user.account.credit_score >= 670 %}Good
                                                {% elif user.account.credit_score >= 580 %}Fair
                                                {% else %}Poor
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="nk-wgw-balance">
                                        <div class="amount text-dark credit-score">
                                            <span class="score-number">{{ user.account.credit_score }}</span>
                                            <span class="badge badge-pill 
                                                {% if user.account.credit_score >= 740 %}bg-success
                                                {% elif user.account.credit_score >= 670 %}bg-primary
                                                {% elif user.account.credit_score >= 580 %}bg-warning
                                                {% else %}bg-danger
                                                {% endif %}">
                                                {% if user.account.credit_score >= 740 %}Great
                                                {% elif user.account.credit_score >= 670 %}Good
                                                {% elif user.account.credit_score >= 580 %}Fair
                                                {% else %}Needs Work
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div><!-- .col -->
                </div><!-- .row -->
            </div> <!-- .nk-block -->
        </div><!-- .col -->
    </div><!-- .row -->
</div><!-- .nk-block -->


    <style>
        .responsive-balance {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
            gap: 4px;
            max-width: 100%;
            overflow-wrap: anywhere;
            font-size: clamp(1rem, 3.5vw, 1.75rem);
            word-break: break-word;
            line-height: 1.2;
            font-weight: 600;
        }

        .responsive-balance .currency-symbol,
        .responsive-balance .balance-amount,
        .responsive-balance .currency {
            white-space: nowrap;
            flex-shrink: 1;
            min-width: 0;
        }

        .user-name {
            margin-top: 8px;
            font-weight: 600;
            color: #fff;
        }

        .account-status, .card-info, .security-status {
            margin-top: 5px;
        }

        .account-details, .loan-details, .credit-details {
            display: flex;
            flex-direction: column;
        }

        .account-type, .loan-status, .credit-rating {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .ip-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ip-details {
            display: flex;
            flex-direction: column;
            font-size: 0.82rem;
        }

        .ip-address {
            font-weight: 600;
            font-family: monospace;
        }

        .credit-score {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-number {
            font-size: 1.5em;
            font-weight: bold;
        }

        .nk-wgw-icon {
            border-radius: 8px;
        }

        .card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>

    <script>
        function fetchIPAddress() {
            fetch('https://ipwho.is/')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const ipAddress = data.ip;
                        const city = data.city || "Unknown City";
                        const region = data.region || data.region_name || "Unknown Region";
                        const country = data.country || "Unknown Country";
                        const flagUrl = data.flag?.img || "";
                        const isp = data.connection?.isp || "Unknown ISP";

                        document.getElementById('ip').textContent = ipAddress;
                        document.getElementById('location').textContent = `${city}, ${region}`;
                        
                        if (flagUrl) {
                            document.getElementById('flag').setAttribute('src', flagUrl);
                            document.getElementById('flag').setAttribute('alt', `${country} Flag`);
                        }
                        
                        document.getElementById('isp').textContent = `ISP: ${isp}`;
                    } else {
                        document.getElementById('ip').textContent = 'IP unavailable';
                        document.getElementById('location').textContent = 'Location unavailable';
                        document.getElementById('isp').textContent = 'ISP unavailable';
                    }
                })
                .catch(error => {
                    console.error('Error fetching IP:', error);
                    document.getElementById('ip').textContent = 'IP unavailable';
                    document.getElementById('location').textContent = 'Location unavailable';
                    document.getElementById('isp').textContent = 'ISP unavailable';
                });
        }

        function formatNumberWithCommas(number) {
            return parseFloat(number).toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatBalances() {
            const balanceElements = document.querySelectorAll('.balance-amount');
            balanceElements.forEach(element => {
                const balance = element.getAttribute('data-balance');
                if (balance) {
                    element.textContent = formatNumberWithCommas(balance);
                }
            });
        }

        window.onload = function() {
            fetchIPAddress();
            formatBalances();
        };
    </script>


                            <!-- .nk-block -->
                             <div class="nk-block nk-block-lg">
                                
                                <div class="row gy-gs">
                                    <!-- Left Column -->
                                    <div class="col-md-6">
                                        <div class="card-head">
                                            <div class="card-title mb-0">
                                                <h5 class="title">Recent Int'l Bank Transaction</h5>
                                            </div>
                                            <div class="card-tools">
                                                <ul class="card-tools-nav">
                                                    <li class="active"><a href="{% url 'transactions:recent_withdrawals' %}">All</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- Regular withdrawals list -->
<div class="tranx-list card card-bordered">
    {% for obj in withdrawal reversed %}
    <div class="tranx-item">
        <div class="tranx-col">
            <div class="tranx-info">
                <div class="tranx-data">
                    <div class="tranx-label">{{ obj.target }}<em class="tranx-icon sm icon ni ni-wallet-out"></em></div>
                    <div class="tranx-date">{{ obj.timestamp }}</div>
                    <div class="text-primary">{{ obj.method }}</div>
                </div>
            </div>
        </div>
        <div class="tranx-col">
            <div class="tranx-amount">
                <div class="tranx-date">Amount</div>
                <div class="text-danger fs-16px">
                    - {{ obj.amount }}
                    <span class="currency currency-{{ user.account.account_currency }}">
                        <span class="currency currency-btc">{{ user.account.account_currency }}</span>
                    </span>
                </div>
                <div class="number-sm">
                    <strong class="text-success">{{ obj.status }}</strong>
                </div>
            </div>
        </div>
        <div class="tranx-col">
            <div class="tranx-amount">
                <div class="number">Debit<span class="currency currency-btc"></span></div>
                <span class="badge badge-dim badge-pill badge-outline-primary" data-toggle="modal" data-target="#modalDefault{{ forloop.counter }}">
                    View Details
                </span>
            </div>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="modal fade" tabindex="-1" id="modalDefault{{ forloop.counter }}">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-light">
                    <h5 class="modal-title text-light">Transaction Details</h5>
                    <a href="#" class="close text-light" data-dismiss="modal" aria-label="Close">
                        <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <ul class="buysell-overview-list">
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Amount Debited</span>
                            </span>
                            <span class="pm-title">- {{ obj.amount }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Transaction Reference:</span>
                            </span>
                            <span class="pm-title">MIL/{{ obj.pk }}{{ user.account_no }}{{ obj.pk }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Beneficiary Account Holder:</span>
                            </span>
                            <span class="pm-title">{{ obj.target }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Bank Name:</span>
                            </span>
                            <span class="pm-title">{{ obj.recipient_bank_name }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Date:</span>
                            </span>
                            <span class="pm-title">{{ obj.timestamp }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Account Number:</span>
                            </span>
                            <span class="pm-title">{{ obj.account_number }}</span>
                        </li>
                        <li class="buysell-overview-item">
                            <span class="pm-currency">
                                <em class="icon ni ni-check-circle-fill"></em>
                                <span>Available Balance:</span>
                            </span>
                            <span class="pm-title">{{ user.account.account_currency }} {{ user.balance }}</span>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer bg-light">
                    <span class="sub-text text-primary">Processed by Millenium Online Banking Digital Services.</span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <input type="hidden" id="debit1" value="100" />
    <input type="hidden" id="credit1" value="0" />
</div>

                                    </div>

                                    <!-- Right Column -->
                                    <div class="col-md-6">
                                        <div class="card-head">
                                            <div class="card-title mb-0">
                                                <h5 class="title">Recent Local Transfer Activities</h5>
                                            </div>
                                        </div>
                                        <!-- Received transactions -->
                                        <div class="tranx-list card card-bordered">
{% if local_withdrawals_received %}
    {% for obj in local_withdrawals_received %}
        <div class="tranx-item">
            <div class="tranx-col">
                <div class="tranx-info">
                    <div class="tranx-data">
                        <div class="tranx-label">{{ obj.sender_name }}<em class="tranx-icon sm icon ni ni-wallet-in"></em></div>
                        <div class="tranx-date">{{ obj.timestamp }}</div>
                        <div class="text-primary">{{ obj.status }}</div>
                    </div>
                </div>
            </div>
            <div class="tranx-col">
                <div class="tranx-amount">
                    <div class="tranx-date">Amount</div>
                    <div class="text-success fs-16px">+ {{ obj.amount }} 
                        <span class="currency currency-{{ user.account.account_currency }}">
                            <span class="currency currency-btc">{{ user.account.account_currency }}</span>
                        </span>
                    </div>
                    <div class="number-sm">
                        <strong class='text-success'>{{ obj.status }}</strong>
                    </div>
                </div>
            </div>
            <div class="tranx-col">
                <div class="tranx-amount">
                    <div class="number">Credit<span class="currency currency-btc"></span></div>
                    <span class="badge badge-dim badge-pill badge-outline-primary" data-toggle="modal" data-target="#withdrawalReceivedModal_{{ obj.pk }}_{{ obj.timestamp|date:'U' }}">
                        View Details
                    </span>
                </div>
            </div>
        </div>

        <!-- Transaction Details Modal -->
        <div class="modal fade" tabindex="-1" id="withdrawalReceivedModal_{{ obj.pk }}_{{ obj.timestamp|date:'U' }}">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-light">
                        <h5 class="modal-title text-light">Transaction Details</h5>
                        <a href="#" class="close text-light" data-dismiss="modal" aria-label="Close">
                            <em class="icon ni ni-cross"></em>
                        </a>
                    </div>
                    <div class="modal-body">
                        <ul class="buysell-overview-list">
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Amount Credited:</span>
                                </span>
                                <span class="pm-title">{{ obj.amount }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Transaction Reference:</span>
                                </span>
                                <span class="pm-title">MIL/{{ obj.pk }}{{ obj.sender_name|slice:"2"|capfirst }}{{ obj.user.account.account_no|slice:"3"|capfirst }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Account Holder:</span>
                                </span>
                                <span class="pm-title">{{ obj.sender_name }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Date:</span>
                                </span>
                                <span class="pm-title">{{ obj.timestamp }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Account Number:</span>
                                </span>
                                <span class="pm-title">{{ obj.user.account.account_no }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle-fill"></em>
                                    <span>Available Balance:</span>
                                </span>
                                <span class="pm-title">{{ user.account.account_currency }} {{ user.balance }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="modal-footer bg-light">
                        <span class="sub-text text-primary">Processed by Millenium Online Banking Digital Services.</span>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}
                                        </div>
                                        <!-- Sent transactions -->
<!-- Sent transactions -->
{% if local_withdrawals_sent %}
    {% for obj in local_withdrawals_sent %}
        <div class="tranx-item">
            <div class="tranx-col">
                <div class="tranx-info">
                    <div class="tranx-data">
                        <div class="tranx-label">{{ obj.recipient_name }}<em class="tranx-icon sm icon ni ni-wallet-out"></em></div>
                        <div class="tranx-date">{{ obj.timestamp }}</div>
                        <div class="text-primary">{{ obj.status }}</div>
                    </div>
                </div>
            </div>
            <div class="tranx-col">
                <div class="tranx-amount">
                    <div class="tranx-date">Withdrawal Amount</div>
                    <div class="text-danger fs-16px">- {{ obj.amount }} 
                        <span class="currency currency-{{ user.account.account_currency }}">
                            {{ user.account.account_currency }}
                        </span>
                    </div>
                    <div class="number-sm">
                        <strong class='text-success'>{{ obj.status }}</strong>
                    </div>
                </div>
            </div>
            <div class="tranx-col">
                <div class="tranx-amount">
                    <div class="number">Withdrawal<span class="currency currency-btc"></span></div>
                    <span class="badge badge-dim badge-pill badge-outline-danger" data-toggle="modal" data-target="#withdrawalModal{{ obj.pk }}">
                        View Details
                    </span>
                </div>
            </div>
        </div>

        <!-- Withdrawal Details Modal -->
        <div class="modal fade" tabindex="-1" id="withdrawalModal{{ obj.pk }}">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-light">
                        <h5 class="modal-title text-light">Withdrawal Transaction Details</h5>
                        <a href="#" class="close text-light" data-dismiss="modal" aria-label="Close">
                            <em class="icon ni ni-cross"></em>
                        </a>
                    </div>
                    <div class="modal-body">
                        <ul class="buysell-overview-list">
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-money"></em>
                                    <span>Withdrawal Amount:</span>
                                </span>
                                <span class="pm-title text-danger">- {{ obj.amount }} {{ user.account.account_currency }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-file-text"></em>
                                    <span>Transaction ID:</span>
                                </span>
                                <span class="pm-title">WD{{ obj.pk }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-user"></em>
                                    <span>Recipient Name:</span>
                                </span>
                                <span class="pm-title">{{ obj.recipient_name }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-calendar"></em>
                                    <span>Withdrawal Date:</span>
                                </span>
                                <span class="pm-title">{{ obj.timestamp }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-building"></em>
                                    <span>Bank Account:</span>
                                </span>
                                <span class="pm-title">{{ obj.recipient_account_number }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-wallet-alt"></em>
                                    <span>Remaining Balance:</span>
                                </span>
                                <span class="pm-title">{{ user.account.account_currency }} {{ user.balance }}</span>
                            </li>
                            <li class="buysell-overview-item">
                                <span class="pm-currency">
                                    <em class="icon ni ni-check-circle"></em>
                                    <span>Status:</span>
                                </span>
                                <span class="pm-title text-success">{{ obj.status }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="modal-footer bg-light">
                        <span class="sub-text text-danger">Withdrawal processed via Millenium Online Banking</span>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
{% endif %}
                                    </div>
                                </div>
                            </div>
                                        <div class="col-12">
                                            <div class="card-head">
                                                <!-- .card -->
                                                <p></p>
                                                <div class="tradingview-widget-container" style="width: 100%; height: 350px;">
                                                    <div class="tradingview-widget-container__widget"></div>
                                                    <div class="tradingview-widget-copyright">
                                                        <a href="https://www.tradingview.com/symbols/EURUSD/?exchange=FX" rel="noopener" target="_blank">
                                                            <span class="blue-text">EURUSD Rates</span>
                                                        </a>
                                                    </div>
                                                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                                                    {
                                                        "symbol": "FX:EURUSD",
                                                        "width": "100%",
                                                        "height": 320,
                                                        "locale": "en",
                                                        "dateRange": "12M",
                                                        "colorTheme": "dark",
                                                        "trendLineColor": "rgba(41, 98, 255, 1)",
                                                        "underLineColor": "rgba(41, 98, 255, 0.3)",
                                                        "underLineBottomColor": "rgba(41, 98, 255, 0)",
                                                        "isTransparent": false,
                                                        "autosize": true,
                                                        "largeChartUrl": ""
                                                    }
                                                    </script>
                                                </div>
                                            </div>
                                        </div>

                            </div><!-- .nk-block -->
                            <div class="nk-block">
                                <div class="card card-bordered">
                                    <div class="card-inner card-inner-lg">
                                        <div class="align-center flex-wrap flex-md-nowrap g-4">
                                            <div class="nk-block-image w-120px flex-shrink-0">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 118">
                                                    <path d="M8.916,94.745C-.318,79.153-2.164,58.569,2.382,40.578,7.155,21.69,19.045,9.451,35.162,4.32,46.609.676,58.716.331,70.456,1.845,84.683,3.68,99.57,8.694,108.892,21.408c10.03,13.679,12.071,34.71,10.747,52.054-1.173,15.359-7.441,27.489-19.231,34.494-10.689,6.351-22.92,8.733-34.715,10.331-16.181,2.192-34.195-.336-47.6-12.281A47.243,47.243,0,0,1,8.916,94.745Z" transform="translate(0 -1)" fill="#f6faff" />
                                                    <rect x="18" y="32" width="84" height="50" rx="4" ry="4" fill="#fff" />
                                                    <rect x="26" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe" />
                                                    <rect x="50" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe" />
                                                    <rect x="74" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe" />
                                                    <rect x="38" y="60" width="20" height="12" rx="1" ry="1" fill="#e5effe" />
                                                    <rect x="62" y="60" width="20" height="12" rx="1" ry="1" fill="#e5effe" />
                                                    <path d="M98,32H22a5.006,5.006,0,0,0-5,5V79a5.006,5.006,0,0,0,5,5H52v8H45a2,2,0,0,0-2,2v4a2,2,0,0,0,2,2H73a2,2,0,0,0,2-2V94a2,2,0,0,0-2-2H66V84H98a5.006,5.006,0,0,0,5-5V37A5.006,5.006,0,0,0,98,32ZM73,94v4H45V94Zm-9-2H54V84H64Zm37-13a3,3,0,0,1-3,3H22a3,3,0,0,1-3-3V37a3,3,0,0,1,3-3H98a3,3,0,0,1,3,3Z" transform="translate(0 -1)" fill="#798bff" />
                                                    <path d="M61.444,41H40.111L33,48.143V19.7A3.632,3.632,0,0,1,36.556,16H61.444A3.632,3.632,0,0,1,65,19.7V37.3A3.632,3.632,0,0,1,61.444,41Z" transform="translate(0 -1)" fill="#6576ff" />
                                                    <path d="M61.444,41H40.111L33,48.143V19.7A3.632,3.632,0,0,1,36.556,16H61.444A3.632,3.632,0,0,1,65,19.7V37.3A3.632,3.632,0,0,1,61.444,41Z" transform="translate(0 -1)" fill="none" stroke="#6576ff" stroke-miterlimit="10" stroke-width="2" />
                                                    <line x1="40" y1="22" x2="57" y2="22" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                                                    <line x1="40" y1="27" x2="57" y2="27" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                                                    <line x1="40" y1="32" x2="50" y2="32" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                                                    <line x1="30.5" y1="87.5" x2="30.5" y2="91.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round" />
                                                    <line x1="28.5" y1="89.5" x2="32.5" y2="89.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round" />
                                                    <line x1="79.5" y1="22.5" x2="79.5" y2="26.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round" />
                                                    <line x1="77.5" y1="24.5" x2="81.5" y2="24.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round" />
                                                    <circle cx="90.5" cy="97.5" r="3" fill="none" stroke="#9cabff" stroke-miterlimit="10" />
                                                    <circle cx="24" cy="23" r="2.5" fill="none" stroke="#9cabff" stroke-miterlimit="10" /></svg>
                                            </div>
                                            <div class="nk-block-content">
                                                <div class="nk-block-content-head px-lg-4">
                                                    <h5>We’re here to help you!</h5>
                                                    <p class="text-soft">Ask a question or file a support ticket, manage request, report an issues. Our team support team will get back to you by email.</p>
                                                </div>
                                            </div>
                                            <div class="nk-block-content flex-shrink-0">
                                                <a href="{% url 'transactions:ticket' %}" class="btn btn-lg btn-outline-primary">Get Support Now</a>
                                            </div>
                                        </div>
                                    </div><!-- .card-inner -->
                                </div><!-- .card -->
                            </div><!-- .nk-block -->
                        </div>
                    </div>
                </div>
{% endblock content %}
